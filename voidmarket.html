<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VoidMarket ‚Äì Collectibles & Digital Art</title>
  <link rel="stylesheet" href="style.css" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
  (function guardAuth(){
    try {
      const sess = JSON.parse(localStorage.getItem("vm_session_v1"));
      if (!sess || !sess.username) {
        // not logged in -> replace history entry so back won't return
        location.replace("index.html");
        return;
      }
      // Handle bfcache restore (user pressed Back)
      window.addEventListener("pageshow", function (e) {
        if (e.persisted) {
          const s = JSON.parse(localStorage.getItem("vm_session_v1") || "null");
          if (!s || !s.username) location.replace("index.html");
        }
      });
    } catch {
      location.replace("index.html");
    }
  })();
  
</script>

</head>
<body>
  <header class="vm-header">
    <div class="brand">
      <img src="assets/boxes/beta/bta-sko.png" class="logo" alt="">
      <div>
        <h1>VoidMarket</h1>
        <p class="tag">Open boxes, collect art ‚Äì all free.</p>
      </div>
    </div>

    <div class="wallet">
      <div class="profile">
        <button id="profileBtn" class="profile-btn">
          <span class="avatar">üë§</span>
          <span id="profileName">Guest</span>
        </button>
      </div>
      <div class="coins" title="Your coins">
        <strong id="coinCount">0</strong>
        <span>Credit</span>
      </div>
    </div>

  </header>

  <nav class="vm-tabs" role="tablist" aria-label="Navigation">
    <button class="tab active" data-tab="market">Market</button>
    <button class="tab" data-tab="inventory">Inventory</button>
    <button class="tab" data-tab="profile">Profile</button>
    <button class="tab" data-tab="info">Info</button>
    <button class="tab" data-tab="achievements">Achievements</button>
    <!-- <button id="discordBtn" class="discord-tab">Discord</button> -->
  </nav>

  <main>
    <!-- MARKET -->
    <section id="market" class="tabpanel active" aria-labelledby="market-tab">
      
      
      <div id="marketCards" class="cards"></div>

    </section>

    <!-- INVENTORY -->
    <section id="inventory" class="tabpanel" aria-labelledby="inventory-tab">
      <div class="inv-toolbar">
        <div class="filter">
          <label for="rarityFilter">Filter:</label>
          <select id="rarityFilter">
            <option value="ALL">All</option>
            <option value="COMMON">Common</option>
            <option value="RARE">Rare</option>
            <option value="EPIC">Epic</option>
            <option value="LEGENDARY">Legendary</option>
            <option value="MYTHIC">Mythic</option>
          </select>
        </div>
      </div>

      <div class="search">
        <label for="invSearch">Search:</label>
        <input id="invSearch" type="text" placeholder="Name, set or description..." />
      </div>

      <div id="inventoryGrid" class="grid"></div>
      <p id="emptyInv" class="muted">No items yet ‚Äì open a box in the Market!</p>
    </section>

    <!-- ACHIEVEMENTS -->
    <section id="achievements" class="tabpanel" aria-labelledby="achievements-tab">
      <div class="ach-wrap">
        <h2>Achievements <span id="achCounter" class="ach-counter"></span></h2>
        <p class="muted">Locked achievements appear dimmed until you complete them.</p>
        <div id="achList" class="ach-list"></div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="profile" class="tabpanel" aria-labelledby="profile-tab">
      <div class="profile-page">
        <h2>Profile</h2>
        <p class="muted">Local profile and save data for this browser.</p>

        <div class="profile-grid">
          <div class="profile-card">
            <h3>Overview</h3>
            <p><strong>Username:</strong> <span id="profileUsername">-</span></p>
            <p><strong>Created:</strong> <span id="profileCreatedAt">-</span></p>
            <p><strong>Coins:</strong> <span id="profileCoins">0</span> Credit</p>
          </div>

          <div class="profile-card">
            <h3>Collection</h3>
            <p><strong>Total items:</strong> <span id="profileItemsTotal">0</span></p>
            <p><strong>Unopened boxes:</strong> <span id="profileBoxesTotal">0</span></p>
            <p><strong>Collectibles:</strong> <span id="profileCollectiblesTotal">0</span></p>
            <p><strong>Achievements unlocked:</strong> <span id="profileAchCount">0</span></p>
          </div>

          <!-- Featured items (3 slots) -->
          <div class="profile-card">
            <h3>Featured items</h3>
            <p class="muted"><!-- Tekst inni featured items del --></p>
            <div class="profile-feature-grid">
              <div class="profile-feature-slot" id="profileSlot1"></div>
              <div class="profile-feature-slot" id="profileSlot2"></div>
              <div class="profile-feature-slot" id="profileSlot3"></div>
            </div>
          </div>

          <div class="profile-card profile-danger">
            <h3>Account</h3>
            <p class="muted">These actions only affect this browser.</p>
            <div class="profile-actions">
              <button id="logoutBtn" class="btn ghost">Log out</button>
              <button id="deleteUserBtn" class="btn danger">Delete user &amp; save</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ITEM MODAL -->
    <div id="itemModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Item details">
      <div class="modal-card">
        <button id="itemModalClose" class="modal-close" aria-label="Close">‚úï</button>
        <div class="modal-body">
          <img id="modalImg" src="" alt="" class="modal-img" />
          <div class="modal-info">
            <h3 id="modalName">Item name</h3>
            <div class="modal-meta">
              <span id="modalRarity" class="pill">RARITY</span>
              <span id="modalCount" class="pill">x1</span>
            </div>
            <p id="modalDesc" class="muted">Description...</p>
            <div class="value-row">
              <span>Value (each):</span>
              <strong id="modalValue">0</strong> Credit
            </div>
            <div class="modal-actions">
              <button id="openBoxBtn" class="btn primary" style="display:none">Open box</button> 
              <button id="sellOneBtn" class="btn">Sell 1</button>
            </div>
            <div class="modal-profile-actions">
              <span class="muted small">Show on profile:</span>
              <div class="profile-slot-buttons">
                <button class="btn ghost profile-slot-btn" data-slot="0">Slot 1</button>
                <button class="btn ghost profile-slot-btn" data-slot="1">Slot 2</button>
                <button class="btn ghost profile-slot-btn" data-slot="2">Slot 3</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- INFO -->
    <section id="info" class="tabpanel" aria-labelledby="info-tab">
      <div class="info">

        <h3>EVENTS</h3>
        <ul>
          <li>To see active and upcoming events, join our discord!</li>
          
        </ul>



        <h3>Community Epic/Legendary-drop activity (last 24 h) ‚ö†Ô∏èChart under testing (Not real pulls)‚ö†Ô∏è</h3>
        <canvas id="communityChart" height="140"></canvas>

      </div>
    </section>
  </main>

  <!-- GLOBAL overlays: show over any tab -->
  <div id="openingOverlay" class="opening hidden" aria-live="polite">
    <div class="opening-box">
      <img id="openingImg" src="" alt="Opening box" />
      <div class="opening-pulse"></div>
      <p class="opening-text">Opening...</p>
    </div>
  </div>

  <div id="revealArea" class="reveal hidden" aria-live="polite">
    <div class="sparkle"></div>
    <img id="revealImg" src="" alt="You received" />
    <div class="reveal-info">
      <h3 id="revealName">You got an item!</h3>
      <span id="revealTag" class="pill">RARITY</span>
      <button id="revealClose" class="btn ghost">Close</button>
    </div>
  </div>

  <footer class="vm-footer">
    <small>Built for fun ‚Äì everything runs locally in your browser.</small>
  </footer>

  <div id="toast" class="toast" aria-live="polite"></div>

  <script src="script.js"></script>
</body>
</html>
